def quicksort(a, l, r, trace=False, depth=0):
    comparisons = 0
    assignments = 0
    recursive_calls = 1  # рахунок поточного виклику

    if trace:
        print(f"{'  '*depth}Quicksort виклик: масив = {a}, l = {l}, r = {r}")

    if l < r:
        q, c1, a1 = partition(a, l, r, trace, depth)
        comparisons += c1
        assignments += a1

        c2, a2, r2 = quicksort(a, l, q, trace, depth+1)
        c3, a3, r3 = quicksort(a, q + 1, r, trace, depth+1)

        comparisons += c2 + c3
        assignments += a2 + a3
        recursive_calls += r2 + r3

        if trace:
            print(f"{'  '*depth}Після Quicksort для l={l}, r={r}: масив = {a}")

    else:
        if trace:
            print(f"{'  '*depth}Quicksort виклик: масив = {a}, l = {l}, r = {r}")
        return 0, 0, 0

    return comparisons, assignments, recursive_calls


def partition(a, l, r, trace=False, depth=0):
    comparisons = 0
    assignments = 0

    pivot = a[l]
    assignments += 1
    if trace:
        print(f"{'  '*depth}Вибираємо опорний елемент (pivot): {pivot}")

    i = l - 1
    j = r + 1
    assignments += 2

    while True:
        i += 1
        assignments += 1
        while a[i] < pivot:
            comparisons += 1
            i += 1
            assignments += 1
        comparisons += 1

        j -= 1
        assignments += 1
        while a[j] > pivot:
            comparisons += 1
            j -= 1
            assignments += 1
        comparisons += 1

        comparisons += 1
        if i >= j:
            if trace:
                print(f"{'  '*depth}Індекси перетнулися. Поділ завершено. Повертаємо j={j}.")
            return j, comparisons, assignments

        if trace:
            print(f"{'  '*depth}Поточні індекси: i = {i}, j = {j}. Обмінюємо a[{i}] ({a[i]}) і a[{j}] ({a[j]}). Масив:", end=" ")

        a[i], a[j] = a[j], a[i]
        assignments += 3

        if trace:
            print(a)

print("Введіть кілька цілих чисел від 0 до 100 через пробіл:")
my_list = list(map(int, input().split()))
original_list = my_list.copy()

# Звичайне сортування
total_comparisons, total_assignments, total_recursive_calls = quicksort(my_list, 0, len(my_list) - 1)

print("\nРезультати виконання Python-коду (Лістінг 3):")
print("Оригінальний список:", original_list)
print("Відсортований список:", my_list)
print(f"Загальна кількість порівнянь: {total_comparisons}")
print(f"Загальна кількість присвоювань: {total_assignments}")
print(f"Загальна кількість рекурсивних викликів: {total_recursive_calls}")

# Трасування
print("--- Quicksort за схемою Хоара з трасуванням ---")
my_list = original_list.copy()
quicksort(my_list, 0, len(my_list) - 1, trace=True)
print("Фінальний відсортований список:", my_list)
